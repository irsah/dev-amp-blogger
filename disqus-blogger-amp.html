<div id="Blog1">
	<div id="comments"></div>
	<span class='post-timestamp'><a class='timestamp-link' href=''>&nbsp;</a></span>
	<span class='post-comment-link'><a class="comment-link" href=''>&nbsp;</a></span>
</div>
<script>
/*
# Title		:	Disqus Comments on Blogger AMP HTML Template
# Ver		:	0.9.0
# Date		:	Jan 2017
# Demo		:	https://blogr-amp.blogspot.com
# Author	:	irsah.com
#
# Usages for Disqus:
#
<amp-iframe 
	expr:src='&quot;{{PATH-TO-FILE}}?ampactions=disqus&amp;shortname={{DISQUS_SHORTNAME}}&amp;pagetype={{PAGE_TYPE}}&amp;fontfamily={{FONT_FAMILY}}&amp;fontlinkcolor={{LINK_COLOR}}&amp;canonicalurl=&quot; + data:blog.canonicalUrl + &quot;&amp;url=&quot; + data:blog.url + &quot;&amp;homepageurl=&quot; + data:blog.homepageUrl + &quot;&amp;canonicalhomepageurl=&quot; + data:blog.canonicalHomepageUrl' 
	frameborder='0' 
	height='400' 
	layout='responsive' 
	resizable='resizable' 
	sandbox='allow-forms allow-scripts allow-same-origin allow-modals allow-popups' 
	width='600'>
</amp-iframe>
#
# Instructions:
# Copy paste <amp-iframe/> markup above & place anywhere at Blogger HTML within <body>...</body> tag.
# [*] Replace {{PATH-TO-FILE}} to this file hosted on an HTTPS enabled host.
# [*] Replace {{DISQUS_SHORTNAME}} with Disqus shortname created/attached to blog.
# Replace {{ PAGETYPE }} with value " index " or " item " (without quotes). (default: item)
# Replace {{FONT_FAMILY}} with CSS font family. (default: sans-serif)
# Replace {{LINK_COLOR}} with HEX color code. (default: 000000)
#
# [*] required values
#
*/

var doc = document;
var win = window;

win.addEventListener('message', receiveMessage, false);
  
function receiveMessage( event ) {
	if ( event.data ) {
  	var msg;
  	try {
    	msg = JSON.parse( event.data );
  	} catch (err) {};
  	if (!msg) return false;
 		if ( msg.name === 'resize' ) {
    	win.parent.postMessage({
      	sentinel: 'amp',
      	type: 'embed-size',
      	height: msg.data.height
    	}, '*');
  	};
  };    
};

function getQueryValue( vars ) {
  var query = win.location.search.substring(1);
  var variable = query.split('&');
  for (var i = 0; i < variable.length; i++) {
    var values = variable[i].split('=');
    if ( values[0] === vars ) {
      return values[1];
    };
  };
  return (false);
};
  
function loadMessage(){
	var H3 = doc.createElement('h3');
	H3.innerHTML = 'No contents available.'
	( doc.getElementsByTagName('head')[0] || doc.getElementsByTagName('body')[0] ).appendChild( H3 )
};

	
/* loads Disqus js */
var pagetype = getQueryValue('pagetype');
if ( pagetype === false ) pagetype = 'item';
var disqus_shortname = getQueryValue('shortname');
var disqus_blogger_current_url = getQueryValue('canonicalurl');
if ( !disqus_blogger_current_url.length ) {
  disqus_blogger_current_url = getQueryValue('url');
};
var disqus_blogger_homepage_url = getQueryValue('homepageurl');
var disqus_blogger_canonical_homepage_url = getQueryValue('canonicalhomepageurl');	
	
var time = doc.querySelector('.timestamp-link');
time.setAttribute('href', getQueryValue('canonicalurl') );
var link = doc.querySelector('.comment-link');
link.setAttribute('href', getQueryValue('canonicalurl') );
	
function loadDisqus(){ 
	var fontfamily = getQueryValue( 'fontfamily' ) === false ? 'sans-serif': getQueryValue( 'fontfamily' );
	var fontlinkcolor = getQueryValue( 'fontlinkcolor') === false ? '000000' : getQueryValue( 'fontlinkcolor') ;
	var disquscss = '#disqus_thread { font-family:' + fontfamily + '} a { color: #' + fontlinkcolor + '}',
	head = doc.getElementsByTagName('head')[0],
	tag = doc.createElement('style');
	tag.type = 'text/css';
	if ( tag.styleSheet ){
  		tag.styleSheet.cssText = disquscss;
	} else {
  		tag.appendChild( doc.createTextNode( disquscss ) );
	};
	head.appendChild( tag );

	if( pagetype === "item"){
		(function() {
			var js = doc.createElement('script');
			js.type = 'text/javascript';
			js.async = true;
			js.src = '//'+disqus_shortname+'.disqus.com/blogger_item.js';
			(doc.getElementsByTagName('head')[0] || doc.getElementsByTagName('body')[0]).appendChild( js );
		})();
	} else {
		(function(){
			
			var div = doc.getElementById('comments');
			div.parentNode.removeChild( div );
			
			 var hasClass = function(obj,className) {
				 var re = new RegExp("(^|\\s)" + className + "(\\s|$)");
				 return re.test(obj.className);
			 };

			 var get_blog_block = function() {
				 var block;
				 for(var i = 0;Math.min(i,19) != 19; i++) {
					 block = document.getElementById('Blog'+i);
					 if (!!block) break;
				 }
				 return block;
			 };
			 var change_links = function(post) {
				 var spans = post.getElementsByTagName('span');
				 var anchors, changelist = [], permalink = '', tempanchor, permalink_found = false, elements;
				 for(var i = 0; Math.min(i, spans.length) != (spans.length); i++) {
					 if ((hasClass(spans[i], 'post-timestamp') || hasClass(spans[i], 'disqus-blogger-permalink')) && !permalink_found) {
						 anchors = spans[i].getElementsByTagName('a');
						 for (var q=0; Math.min(q, anchors.length) != (anchors.length); q++) {
							 if (hasClass(anchors[q], 'timestamp-link') || hasClass(anchors[q], 'disqus-blogger-permalink-url')) {
								 permalink = anchors[q].href;
								 permalink_found = true;
							 }
						 }
					 }
					 if (hasClass(spans[i], 'post-comment-link') || hasClass(spans[i], 'disqus-blogger-comment-link'))
						 changelist.push(spans[i]);
				 }
				 //if not found, use slower method and iterate through every element in the post
				 if (!permalink_found) {
					 elements = post.getElementsByTagName('*');
					 for(var k = 0; k < elements.length; k++) {
						 if ((hasClass(elements[k], 'entry-title')||hasClass(elements[k], 'post-title')) && !permalink_found) {
							 anchors = elements[k].getElementsByTagName('a');
							 for (var g=0; g < anchors.length; g++) {
								 if (!!anchors[g].href) {
									 permalink = anchors[g].href;
									 permalink_found = true;
									 break;
								 }
							 }
						 }
						 if (permalink_found) break;
					 }
				 }

				 // if we still can't find a permalink, just skip this post and call it a loss
				 if (!permalink_found) {
					return;
				 }

				 // with blogger's country specific tld changes, we need to check to see if the permalink we grabbed
				 // matches a country specific tld.  to do so, we use the blog.homepageUrl and blog.homepageCanonicalUrl
				 // we set in the actual widget html to check and do a search and replace
				 // if the normal url and the canonical url match, then we know there isn't a country specific tld
				 if ((disqus_blogger_homepage_url && disqus_blogger_canonical_homepage_url) &&
					 (disqus_blogger_homepage_url != disqus_blogger_canonical_homepage_url)) {
					 // make sure that the country tld is in the permalink
					 if (permalink.match(disqus_blogger_homepage_url)) {
						// switch out country specific tld for canonical normal tld
						permalink = permalink.replace(disqus_blogger_homepage_url, disqus_blogger_canonical_homepage_url);
					 }
				 }

				 tempanchor = document.createElement('a');
				 tempanchor.className = 'comment-link disqus-blogger-comment-link';
				 tempanchor.href = permalink + '#disqus_thread';
				 for (var j=0; Math.min(j, changelist.length) != (changelist.length); j++) {
					 changelist[j].innerHTML = '';
					 changelist[j].appendChild(tempanchor);
					 changelist[j].style.visibility = 'visible';
				 }
				 //if no comment-link elements were found, append to timestamp
				 if (changelist.length === 0) {
					 for(var h = 0; Math.min(h, spans.length) != (spans.length); h++) {
						 if (hasClass(spans[h], 'post-timestamp') || hasClass(spans[h], 'disqus-blogger-permalink'))
							 spans[h].appendChild(tempanchor);
					 }
				 }
			 };
			 var blog_block = get_blog_block();
			 if (!!blog_block) {
				 var posts = blog_block.getElementsByTagName('div');
				 for(var i = 0; Math.min(i, posts.length) != (posts.length); i++) {
					 if (hasClass(posts[i], "hentry") || hasClass(posts[i], "post") || hasClass(posts[i], 'disqus-blogger-post'))
						 change_links(posts[i]);
				 }
				 (function () {
					  var s = document.createElement('script'); s.async = true;
					  s.src = '//'+disqus_shortname+'.disqus.com/count.js';
					  (document.getElementsByTagName('HEAD')[0] || document.body).appendChild(s);
				  }());
			 }

		})();
	};
};
	
var actions = getQueryValue( 'ampactions' );
switch ( actions ){
	case 'disqus' : loadDisqus(); break;
	default : loadMessage();
};
</script>

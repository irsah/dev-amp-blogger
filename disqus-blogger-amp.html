<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

</head>
<body>

<div id="comments"></div>

<script>
/*
# Title		:	Disqus Comments on Blogger AMP HTML Template
# Ver		:	0.9.0
# Date		:	Jan 2017
# Demo		:	https://blogr-amp.blogspot.com
# Author	:	irsah.com
#
# Usages for Disqus:
#
<amp-iframe 
	expr:src='&quot;{{PATH-TO-FILE}}?ampactions=disqus&amp;shortname={{DISQUS_SHORTNAME}}&amp;pagetype={{PAGE_TYPE}}&amp;fontfamily={{FONT_FAMILY}}&amp;fontlinkcolor={{LINK_COLOR}}&amp;canonicalurl=&quot; + data:blog.canonicalUrl + &quot;&amp;url=&quot; + data:blog.url + &quot;&amp;homepageurl=&quot; + data:blog.homepageUrl + &quot;&amp;canonicalhomepageurl=&quot; + data:blog.canonicalHomepageUrl' 
	frameborder='0' 
	height='400' 
	layout='responsive' 
	resizable='resizable' 
	sandbox='allow-forms allow-scripts allow-same-origin allow-modals allow-popups' 
	width='600'>
</amp-iframe>
#
# Instructions:
# Copy paste <amp-iframe/> markup above & place anywhere at Blogger HTML within <body>...</body> tag.
# [*] Replace {{PATH-TO-FILE}} to this file hosted on an HTTPS enabled host.
# [*] Replace {{DISQUS_SHORTNAME}} with Disqus shortname created/attached to blog.
# Replace {{ PAGETYPE }} with value " index " or " item " (without quotes). (default: item)
# Replace {{FONT_FAMILY}} with CSS font family. (default: sans-serif)
# Replace {{LINK_COLOR}} with HEX color code. (default: 000000)
#
# [*] required values
#
*/

var doc = document;
var win = window;

win.addEventListener('message', receiveMessage, false);
  
function receiveMessage( event ) {
	if ( event.data ) {
  	var msg;
  	try {
    	msg = JSON.parse( event.data );
  	} catch (err) {};
  	if (!msg) return false;
 		if ( msg.name === 'resize' ) {
    	win.parent.postMessage({
      	sentinel: 'amp',
      	type: 'embed-size',
      	height: msg.data.height
    	}, '*');
  	};
  };    
};

function getQueryValue( vars ) {
  var query = win.location.search.substring(1);
  var variable = query.split('&');
  for (var i = 0; i < variable.length; i++) {
    var values = variable[i].split('=');
    if ( values[0] === vars ) {
      return values[1];
    };
  };
  return (false);
};
  
function loadMessage(){
	var H3 = doc.createElement('h3');
	H3.innerHTML = 'No contents available.'
	( doc.getElementsByTagName('head')[0] || doc.getElementsByTagName('body')[0] ).appendChild( H3 )
};

var pagetype = getQueryValue('pagetype');
if ( pagetype === false ) pagetype = 'item';
var disqus_shortname = getQueryValue('shortname');
var disqus_blogger_current_url = getQueryValue('canonicalurl');
if ( !disqus_blogger_current_url.length ) {
  disqus_blogger_current_url = getQueryValue('url');
};
var disqus_blogger_homepage_url = getQueryValue('homepageurl');
var disqus_blogger_canonical_homepage_url = getQueryValue('canonicalhomepageurl');	
	
/* loads Disqus js */
function loadDisqus(){ 

	var fontfamily = getQueryValue( 'fontfamily' ) === false ? 'sans-serif': getQueryValue( 'fontfamily' );
	var fontlinkcolor = getQueryValue( 'fontlinkcolor') === false ? '000000' : getQueryValue( 'fontlinkcolor') ;
	var disquscss = '#disqus_thread { font-family:' + fontfamily + '} a { color: #' + fontlinkcolor + '}',
	head = doc.getElementsByTagName('head')[0],
	tag = doc.createElement('style');
	tag.type = 'text/css';
	if ( tag.styleSheet ){
  		tag.styleSheet.cssText = disquscss;
	} else {
  		tag.appendChild( doc.createTextNode( disquscss ) );
	};
	head.appendChild( tag );

	if( pagetype === "item"){
		(function() {
			var js = doc.createElement('script');
			js.type = 'text/javascript';
			js.async = true;
			js.src = '//'+disqus_shortname+'.disqus.com/blogger_item.js';
			(doc.getElementsByTagName('head')[0] || doc.getElementsByTagName('body')[0]).appendChild( js );
		})();
	};
};
	
var actions = getQueryValue( 'ampactions' );
switch ( actions ){
	case 'disqus' : loadDisqus(); break;
	default : loadMessage();
};
	
;(function($) {
	var feed = "https://feeds.feedburner.com/Blogr-AMP?format=xml";
	$.ajax( feed , {
		accepts: { xml : "application/rss+xml" },
		dataType : "xml",
		success : function( data ) {
			var entry = $( data ).find( 'entry' );
			if ( typeof entry === undefined ) return false;
			var UL = $('<ul/>').attr({ id : 'list-items' });
			for ( var i = 0; i < 3; i++){
				var LI = ('<li/>').attr({ class : 'list-item' });	
				var caption = $('<div />').attr({ class : 'list-caption' });
				var post = entry[i];
				var title = post.find('title').text();
				var link = $('a').attr({ href : post.find('feedburner:origLink').text() });
				var image_url = post.find('media:thumbnail');
				if ( typeof image_url === undefined ) {
					image_url = '//4.bp.blogspot.com/-MowVHfLkoZU/VhgIRyPbIoI/AAAAAAAATtE/qHST4Q2YCCc/s1600/placeholder-image.jpg';	
				};
			    if ( image_url.indexOf("s72-c") !== -1){
					image_url = image_url.replace( 's72-c' , 's'+ 400 );
				} else if ( image_url.indexOf('ytimg') !== -1){
					var yt1 = image_url.indexOf('/vi/'),
					yt2 = image_url.lastIndexOf('/'),
					yt3 = image_url.substring( yt1+4 , yt2 );
					image_url = '//i.ytimg.com/vi/' + yt3 + '/sddefault.jpg';
				} else if ( image_url.indexOf('img.youtube') !== -1 ){
					var yt4 = image_url.indexOf('/vi/'),
					yt5 = image_url.lastIndexOf('/'),
					yt6 = image_url.substring( yt4+4 , yt5);
					image_url = '//img.youtube.com/vi/'+yt6+'/sddefault.jpg';
				};
				caption
					.prepend( $('<h4 />').html('<a href="' + link + '">' + title + '</a>') )
					.prepend( $('<span />').html( post.find('updated').text() ) )
					.prepend( $('<a />').attr('href', post.find('author uri').text() ).html( post.find('author name').text() ) );
				var content = post.find('content').text();
				if( content.length > 160 ){
					content = content.substring( 0 , 160 );
					var end = content.lastIndexOf(" ");
					content = $('<p />').html( content.substring( 0 , end ) + '...' );
					caption.prepend( content )
				};		
				LI
				.append( $('<img />').attr({ src: image_url, alt : title }) )
				.append( caption )
				.appendTo(UL);
			};
			$('body').append( UL );
		}
	});
})(jQuery);
	
</script>
	
</body>
</html>
